function toggleLoading(){isLoading?($("#loader").hide(),$("#form-starwars").show()):($("#loader").show(),$("#form-starwars").hide()),isLoading=!isLoading}function validateEmail(t){var e=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)}StarWarsOpening=function(){function t(t){this.el=$(t.el),this.audio=this.el.find("audio").get(0),this.audioDefer=$.Deferred();var e=this;this.audio.oncanplaythrough=function(){e.audioDefer.resolve()},this.start=this.el.find(".start"),this.animation=this.el.find(".animation"),this.reset(),$(this.audio).bind("ended",$.proxy(function(){this.audio.currentTime=0,this.reset();var t=this.opening;$("#f-intro").val(t.intro),$("#f-logo").val(t.logo||"Star\nwars"),$("#f-episode").val(t.episode),$("#f-title").val(t.title),$("#f-text").val(t.text),setTimeout(function(){$("body").removeClass("running")},1e4)},this))}return t.prototype.reset=function(){this.start.show(),$(".pageHide").show(),this.cloned=this.animation.clone(!0),this.animation.remove(),this.animation=this.cloned,$(window).trigger("resize")},t.prototype.resetAudio=function(){this.audio.pause(),this.audio.currentTime=0},t.prototype.play=function(){this.start.hide(),$(".pageHide").hide(),$("#loader").hide(),$("body").removeClass("running"),$("body").addClass("running"),$("body").scrollTop(0),this.audio.play(),this.el.append(this.animation);var t=$(".titles > div",this.animation)[0];if(t.offsetHeight>1977){for(var e,a=t.offsetHeight-1977,o=.04041570438799076,n=20-a*o,i=document.styleSheets,r=0;r<i.length;++r)for(var s=0;s<i[r].cssRules.length;++s){var l=i[r].cssRules[s];"titles"==l.name&&l.type==CSSRule.KEYFRAMES_RULE&&(e=l)}e&&e.appendRule("100% { top: "+n+"% }")}},t}();var StarWars=new StarWarsOpening({el:".starwars"});swal.setDefaults({customClass:"star-wars-alert"});var OpeningKey=null,audio=document.getElementsByTagName("audio")[0],audioIsLoaded=!1,loadData=function(){audioIsLoaded||(audio.load(),audioIsLoaded=!0)};document.body.addEventListener("touchstart",loadData),window.addEventListener("keydown",function(t){var e=document.activeElement.type||"";e.startsWith("text")||[32,37,38,39,40].indexOf(t.keyCode)>-1&&t.preventDefault()},!1);var notPlayed=!0,isLoading=!1,showFooter=!0;toggleLoading(),$("#form-starwars").submit(function(t){t.preventDefault();var e={intro:$("#f-intro").val(),logo:$("#f-logo").val(),episode:$("#f-episode").val(),title:$("#f-title").val(),text:$("#f-text").val()},a=e.logo.split("\n");return a.length>2?void sweetAlert("Oops...","Logo can't have more than 2 lines.","warning"):void $.ajax({url:"https://starwarsopeninga.firebaseio.com/openings.json",method:"POST",data:JSON.stringify(e),dataType:"json",success:function(t){toggleLoading(),location.hash="!/A"+t.name.substring(1)}})}),$(window).on("hashchange",function(){var t=function(t){var e=t.charAt(0);return"A"===e?(t=t.substr(1),"https://starwarsopeninga.firebaseio.com/openings/-"+t+".json"):"https://starwarsopening.firebaseio.com/openings/-"+t+".json"};$("#playBut").remove();var e=location.hash.replace("#!/","").split("/"),a=e[0],o=!1;try{o="edit"===e[1]}catch(n){}if($("body").removeClass("running"),""!=a)try{var i=t(a);$.ajax({url:i,success:function(t){if(null==t)return void sweetAlert("Oops...","Introduction not found!","error");StarWars.opening=t,OpeningKey=a,$("#videoButton").show();var e=t.intro.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;"),e=e.replace(/\n/g,"<br>"),StarWars.animation.find("#intro").html(e),StarWars.animation.find("#episode").text(t.episode),StarWars.animation.find("#title").text(t.title);var n=t.text.split("\n"),i=StarWars.animation.find("#text");i.text("");for(var r in n)i.append($("<p>").text(n[r]));$("#logosvg",StarWars.animation).css("width",$(window).width()+"px"),$("#logoimg",StarWars.animation).css("width",$(window).width()+"px");var s=t.logo?t.logo:"star\nwars",l=s.split("\n"),d=l[0],u=l[1]||"";if("star\nwars"!=s.toLowerCase()){var h=$("#logosvg text",StarWars.animation);h[0].textContent=d,h[1].textContent=u;var c=d.length>u.length?d:u,f="0 0 "+200*c.length+" 500";$("#logosvg",StarWars.animation).each(function(){$(this)[0].setAttribute("viewBox",f)}),$("#logosvg",StarWars.animation).show(),$("#logoimg",StarWars.animation).hide()}else $("#logosvg",StarWars.animation).hide(),$("#logoimg",StarWars.animation).show();var p=function(){$.when(StarWars.audioDefer).then(function(){var t=StarWars.audio.buffered.end(StarWars.audio.buffered.length-1);0!=t||audioIsLoaded?(toggleLoading(),notPlayed=!1,StarWars.play()):($("#loader").hide(),playbutton=$('<div class="verticalWrapper"><div class="playAudio"><button id="playBut" class="playButton" style="font-size: 80px">Play</button></div></div>'),$("body").append(playbutton),$("#playBut",playbutton).click(function(){$("#loader").show(),playbutton.remove()}),StarWars.audio.oncanplaythrough=function(){toggleLoading(),notPlayed=!1,StarWars.play()}),o&&(StarWars.audio.currentTime=97)})};document.hasFocus()?p():$(window).focus(function(){notPlayed&&p()})}})}catch(r){location.hash="",toggleLoading()}else notPlayed?toggleLoading():(StarWars.reset(),StarWars.resetAudio());ga("send","pageview",{page:location.pathname+location.search+location.hash})}),$(document).ready(function(){window.dispatchEvent(new Event("hashchange"))});var calcTime=function(t){var e=50*(t+1),a=Math.floor(e/60),o=Math.floor(a/24),n="";return o>0&&(n+=o+" days"),3>o&&(a%=24,e%=60,a>0&&(n+=" "+a+" hours"),e>0&&(n+=" "+e+" minutes")),n},requestVideo=function(t,e){if(e===!1)return!1;if(!validateEmail(e))return swal.showInputError("You need to type an e-mail!"),!1;var a="https://coruscant.nihey.org/request?code="+OpeningKey+"&email="+e;$.ajax({url:a,type:"GET",crossDomain:!0,success:function(a){var o=a.queue;swal({html:!0,title:'<h2 style="font-family: StarWars;">video request sent</h2>',text:'<p style="text-align: justify">Your video has been queued. Your current position on the queue is <b>'+(o+1)+"</b>, which will take up to <b>"+calcTime(o)+'</b>.<br>The link to download the video will be sent to the e-mail:<br></p><span style="text-align: center; font-weight: bold">'+e+"</span>"+(t?'<p style="margin-top: 15px">But as you donated, we will bump you up on the queue as soon as we confirm your donation.</p>':"")})}})};$("#videoButton").click(function(){$.ajax({url:"https://coruscant.nihey.org/status?code="+OpeningKey,crossDomain:!0,success:function(t){var e=t.queue;t.url?swal({html:!0,title:'<h2 style="font-family: StarWars;">Download</h2>',text:'<p style="text-align: justify">This video has already been generated, click the link below to download.<br><br><a style="color: #ffd54e;" href="'+t.url+'">'+t.url+"</a></p>"}):swal({html:!0,title:'<h2 style="font-family: StarWars;">Donate and Download</h2>',text:'<p style="text-align: justify">We want to provide videos for free, but we have to use a server to render it, which costs money.<br>There are <b>'+(e+1)+" videos</b> in front of you and it will take <b>"+calcTime(e)+'</b> to be processed.<br>Can\'t wait for it? Donate at least <b>5 dollars</b>, you will jump the queue and your video will be ready in few hours.<br>The video will be rendered in HD quality and MP4 file. To see a sample video click <a style="color: #ffd54e;text-decoration:none;font-weight:bold;" href="https://www.youtube.com/watch?v=IQf8AN07T_E" target="_blank">here</a>. Attention! Make sure there are no typos in your text, there will be no correction after the video rendering.</p><iframe src="./atat.html" height="200px"></iframe>',showCancelButton:!0,confirmButtonText:"Yes, donate!",confirmButtonColor:"#807300",cancelButtonText:"No, I'll get in the queue!",closeOnConfirm:!1,closeOnCancel:!1,animation:"slide-from-top"},function(t){var e={html:!0,title:'<h2 style="font-family: StarWars;">Generate video</h2>',text:'<p style="text-align: justify">Type your email bellow and you will receive a message with the URL to download your video when it\'s ready</p>'+(t?['<p style="text-align: justify">',"  Please, use the same e-mail from you PayPal account.","  You'll be able to add as many e-mails as you want to","  <b>this video</b> without having to donate again. Just add","  your other e-mails after the first one, without donating.","  Attention! Make sure there are no typos in your text, you will need to request a new video download and donate again.","</p>"].join(""):""),type:"input",showCancelButton:!0,inputPlaceholder:"Your e-mail...",closeOnConfirm:!1,showLoaderOnConfirm:!0};t&&(e.title='<h2 style="font-family: StarWars;">Donate</h2>',e.text='Click on the button bellow:<br><iframe src="./donateButtons.html" height="100"></iframe>'+e.text),swal(e,requestVideo.bind(window,t))})}})});